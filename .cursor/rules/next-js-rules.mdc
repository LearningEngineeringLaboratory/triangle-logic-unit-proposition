---
alwaysApply: true
---

You are an expert in TypeScript, Node.js, Next.js App Router, React, Shadcn UI, Radix UI and Tailwind.

## Code Style and Structure

* Write concise, technical TypeScript code with accurate examples.
* Use functional and declarative programming patterns; avoid classes.
* Prefer iteration and modularization over code duplication.
* Use descriptive variable names with auxiliary verbs (e.g., `isLoading`, `hasError`).
* Structure files: exported component, subcomponents, helpers, static content, types.

## Naming Conventions

* Use lowercase with dashes for directories (e.g., `components/auth-wizard`).
* Favor **named exports** for components.

## TypeScript Usage

* Use TypeScript for all code; **prefer interfaces over types**.
* Avoid enums; use maps instead.
* **Use arrow function components exclusively** with TypeScript interfaces.

## Syntax and Formatting

* **Use the `function` keyword for pure helper functions** (non-component utilities).
* Avoid unnecessary curly braces in conditionals; keep simple statements concise.
* Use declarative JSX.
* No classes; prefer composition over inheritance.

## UI and Styling

* Use Shadcn UI, Radix UI, and Tailwind for components and styling.
* Implement responsive design with Tailwind (mobile-first).
* Follow accessible patterns (ARIA, keyboard navigation) with Radix primitives.

## Performance Optimization

* Minimize `use client`, `useEffect`, and `setState`; favor **React Server Components (RSC)**.
* Wrap client components in `Suspense` with a meaningful fallback.
* Use dynamic loading for non-critical components.
* Optimize images: use WebP, include width/height, enable lazy loading.

## Key Conventions

* Use `nuqs` for URL search parameter state management.
* Optimize Core Web Vitals (LCP, CLS, FID).
* **Limit `use client`:**

  * Favor server components and Next.js SSR.
  * Use on small components that need Web APIs or event handlers.
  * Do **not** use client components for data fetching or global state.

## Data Fetching, Rendering, and Routing

* Follow Next.js documentation for App Router data fetching (`fetch`, Route Handlers, Server Actions), rendering (RSC-first), and routing (segment-based, parallel routes, intercepting routes).
* Prefer server-side data access and streaming where possible.
* Keep client components lean; lift data fetching to the server.

## Example Snippets (style reference)

```tsx
// Component (arrow function, named export)
interface ButtonProps {
  label: string
  onClick?: () => void
  isLoading?: boolean
}

export const Button = ({ label, onClick, isLoading }: ButtonProps) => (
  <button
    onClick={onClick}
    disabled={isLoading}
    className="inline-flex items-center rounded-md px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50"
  >
    {isLoading ? "Loading..." : label}
  </button>
)
```

```ts
// Helper (pure function uses `function` keyword)
export function formatCurrency(value: number, locale = "ja-JP", currency = "JPY"): string {
  return new Intl.NumberFormat(locale, { style: "currency", currency }).format(value)
}
```
